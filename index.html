<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Updates Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            padding: 0;
            margin: 0;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Modern Dashboard: Refresh Progress Bar */
        .refresh-progress {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 2px;
            background: linear-gradient(90deg, #1f6feb 0%, #58a6ff 100%);
            z-index: 1000;
            transition: width 1s linear;
        }

        .refresh-progress.refreshing {
            box-shadow: 0 0 8px rgba(31, 111, 235, 0.6);
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-bottom: 1px solid #21262d;
            box-shadow: none;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .github-icon {
            width: 32px;
            height: 32px;
            fill: #c9d1d9;
        }

        .header h1 {
            font-size: 1.25em;
            font-weight: 600;
            color: #c9d1d9;
            margin: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.875em;
            color: #7d8590;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: #3fb950;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .live-dot.paused {
            background: #7d8590;
            animation: none;
        }

        .pause-button {
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            border: 1px solid #30363d;
            color: #c9d1d9;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.875em;
            cursor: pointer;
            transition: all 0.2s;
        }

        .pause-button:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: #8b949e;
        }

        .pause-icon {
            font-size: 1em;
        }

        .timestamp {
            font-size: 0.875em;
            color: #7d8590;
            min-width: 80px;
            text-align: right;
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 32px;
            padding: 24px;
            flex: 1;
            overflow: hidden;
            position: relative;
            align-items: start;
        }

        /* Modern Dashboard: Column Separators */
        .dashboard-container::before,
        .dashboard-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(255, 255, 255, 0.08);
        }

        .dashboard-container::before {
            left: calc(33.333% + 16px);
        }

        .dashboard-container::after {
            left: calc(66.666% + 16px);
        }

        .section {
            background: transparent;
            border-radius: 0;
            padding: 0;
            box-shadow: none;
            border: none;
            backdrop-filter: none;
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .section-content {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        /* TV Display: Subtle fade at bottom to indicate limited view */
        .section-content::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, transparent, #0d1117);
            pointer-events: none;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            padding: 6px 0;
            background: transparent;
            border-radius: 0;
            position: relative;
        }

        .section-header h2 {
            font-size: 1em;
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            margin: 0;
        }

        #blog-section .section-header h2 {
            color: #58a6ff;
        }

        #changelog-section .section-header h2 {
            color: #8250df;
        }

        #status-section .section-header h2 {
            color: #2da44e;
        }

        /* Modern Dashboard: Column Header Accents */
        #blog-section .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: #1f6feb;
        }

        #changelog-section .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, #8250df 0%, #0969da 100%);
        }

        #status-section .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: #2da44e;
        }

        .section-header .icon {
            display: none;
        }

        .item {
            background: transparent;
            border-radius: 0;
            padding: 10px 0;
            margin-bottom: 0;
            border: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            transition: all 0.2s ease;
        }

        .item:hover {
            background-color: rgba(255, 255, 255, 0.03);
            border-bottom-color: rgba(255, 255, 255, 0.1);
        }

        .item-title {
            font-size: 1.0625em;
            font-weight: 400;
            color: #c9d1d9;
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .item-title a {
            color: #58a6ff;
            text-decoration: none;
            transition: color 0.2s;
        }

        .item-title a:hover {
            color: #79c0ff;
            text-decoration: underline;
        }

        .item-description {
            display: none;
        }

        /* Blog-specific styling - Modern Card Treatment */
        .blog-item {
            border-left: 5px solid #1f6feb;
            padding-left: 16px;
            padding-right: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 0 4px 4px 0;
            transition: all 0.2s ease;
        }

        .blog-item:hover {
            padding-left: 20px;
            background: rgba(31, 111, 235, 0.08);
            transform: translateX(2px);
        }

        /* Changelog-specific styling */
        .changelog-item {
            border-left: 4px solid #484f58;
            padding-left: 16px;
            padding-right: 12px;
            transition: all 0.2s ease;
        }

        .changelog-item:hover {
            border-color: #6e7681;
            background: rgba(255, 255, 255, 0.03);
        }

        .changelog-badge {
            display: inline-block;
            background: #6e7681;
            color: #ffffff;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.6875em;
            font-weight: 600;
            text-transform: uppercase;
            margin-left: 8px;
            letter-spacing: 0.5px;
        }

        .changelog-badge-new-feature {
            background: #8250df;
        }

        .changelog-badge-improvement {
            background: #0969da;
        }

        .changelog-badge-bug-fix {
            background: #1a7f37;
        }

        .changelog-badge-ui-change {
            background: #bc4c00;
        }

        .changelog-badge-deprecation {
            background: #cf222e;
        }

        .changelog-category {
            display: inline;
            font-size: 0.6875em;
            color: #6e7681;
            margin-left: 8px;
        }

        .changelog-category::before {
            content: '• ';
        }

        /* Status card styling */
        .status-card {
            border: 2px solid;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 12px;
        }

        .status-card-operational {
            border-color: #2da44e;
            background: rgba(45, 164, 78, 0.15);
        }

        .status-card-minor {
            border-color: #bf8700;
            background: rgba(191, 135, 0, 0.15);
        }

        .status-card-major {
            border-color: #cf222e;
            background: rgba(207, 34, 46, 0.15);
        }

        .status-symbol {
            font-size: 1.25em;
            margin-right: 8px;
        }

        .status-symbol-operational {
            color: #2da44e;
        }

        .status-symbol-minor {
            color: #bf8700;
        }

        .status-symbol-major {
            color: #cf222e;
        }

        /* Item preview - visible 1-line truncated descriptions */
        .item-preview {
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            font-size: 0.8125em;
            color: #8b949e;
            line-height: 1.5;
            margin-bottom: 6px;
        }

        .item-date {
            font-size: 0.75em;
            color: #7d8590;
            font-style: normal;
        }

        .status-text {
            display: inline-block;
            font-size: 0.6875em;
            color: #8b949e;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 2px 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.05);
            margin-left: 8px;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-operational {
            background-color: #3fb950;
        }

        .status-minor {
            background-color: #d29922;
        }

        .status-major {
            background-color: #f85149;
        }

        .loading {
            text-align: center;
            padding: 40px 0;
            font-size: 1em;
            color: #7d8590;
        }

        .error {
            background: transparent;
            border: none;
            border-left: 3px solid #f85149;
            padding: 12px 0 12px 12px;
            border-radius: 0;
            margin: 8px 0;
            color: #f85149;
        }

        @media (max-width: 1600px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            /* Hide column separators on mobile */
            .dashboard-container::before,
            .dashboard-container::after {
                display: none;
            }
        }

        /* Animation for new items */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .item {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body>
    <!-- Modern Dashboard: Refresh Progress Bar -->
    <div class="refresh-progress" id="refreshProgress"></div>
    
    <div class="header">
        <div class="header-left">
            <svg class="github-icon" viewBox="0 0 16 16" version="1.1" aria-hidden="true">
                <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path>
            </svg>
            <h1>GitHub Updates</h1>
        </div>
        <div class="header-right">
            <div class="live-indicator">
                <span class="live-dot" id="liveDot"></span>
                <span id="liveText">Live</span>
            </div>
            <button class="pause-button" id="pauseButton">
                <span class="pause-icon" id="pauseIcon">⏸</span>
                <span id="pauseText">Pause</span>
            </button>
            <div class="timestamp" id="timestamp">--:-- --</div>
        </div>
    </div>

    <div class="dashboard-container">
        <div class="section" id="blog-section">
            <div class="section-header">
                <h2>Blog</h2>
            </div>
            <div class="section-content">
                <div id="blog-content" class="loading">Loading blog posts...</div>
            </div>
        </div>

        <div class="section" id="changelog-section">
            <div class="section-header">
                <h2>Changelog</h2>
            </div>
            <div class="section-content">
                <div id="changelog-content" class="loading">Loading changelog...</div>
            </div>
        </div>

        <div class="section" id="status-section">
            <div class="section-header">
                <h2>Status</h2>
            </div>
            <div class="section-content">
                <div id="status-content" class="loading">Loading status...</div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const RSS2JSON_API = 'https://api.rss2json.com/v1/api.json';
        const GITHUB_BLOG_RSS = 'https://github.blog/feed/';
        const GITHUB_CHANGELOG_RSS = 'https://github.blog/changelog/feed/';
        const GITHUB_STATUS_API = 'https://www.githubstatus.com/api/v2/incidents.json';
        const REFRESH_INTERVAL = 5 * 60 * 1000; // 5 minutes

        // Utility function to format dates
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
                if (diffHours === 0) {
                    const diffMinutes = Math.floor(diffTime / (1000 * 60));
                    return diffMinutes <= 1 ? 'Just now' : `${diffMinutes} minutes ago`;
                }
                return diffHours === 1 ? '1 hour ago' : `${diffHours} hours ago`;
            } else if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            }
            
            return date.toLocaleDateString('en-US', { 
                month: 'short', 
                day: 'numeric', 
                year: 'numeric' 
            });
        }

        // Strip HTML tags from content
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }

        // Truncate text
        function truncate(text, maxLength) {
            if (text.length <= maxLength) return text;
            return text.substring(0, maxLength) + '...';
        }

        // Detect changelog badge type based on keywords
        function detectBadgeType(title, description) {
            const text = (title + ' ' + description).toLowerCase();
            
            if (text.match(/\b(introducing|new|announcing|available|launched|release)\b/)) {
                return { type: 'NEW FEATURE', class: 'changelog-badge-new-feature' };
            }
            if (text.match(/\b(improved|faster|enhanced|better|performance|optimiz)\b/)) {
                return { type: 'IMPROVEMENT', class: 'changelog-badge-improvement' };
            }
            if (text.match(/\b(fix|resolved|corrected|bug|issue)\b/)) {
                return { type: 'BUG FIX', class: 'changelog-badge-bug-fix' };
            }
            if (text.match(/\b(UI|design|interface|visual|redesign)\b/)) {
                return { type: 'UI CHANGE', class: 'changelog-badge-ui-change' };
            }
            if (text.match(/\b(deprecat|removing|sunset|legacy|discontinu)\b/)) {
                return { type: 'DEPRECATION', class: 'changelog-badge-deprecation' };
            }
            
            return { type: 'UPDATE', class: '' };
        }

        // Fetch GitHub Blog
        async function fetchBlog() {
            try {
                const response = await fetch(`${RSS2JSON_API}?rss_url=${encodeURIComponent(GITHUB_BLOG_RSS)}`);
                const data = await response.json();
                
                if (data.status !== 'ok') {
                    throw new Error('Failed to fetch blog RSS');
                }

                const container = document.getElementById('blog-content');
                if (!data.items || data.items.length === 0) {
                    container.innerHTML = '<div class="error">No blog posts available</div>';
                    return;
                }

                // TV Display: Limit to 8 items to fit on screen without scrolling
                const displayCount = Math.min(8, data.items.length);
                container.innerHTML = data.items.slice(0, displayCount).map(item => `
                    <div class="item blog-item">
                        <div class="item-title">
                            <a href="${item.link}" target="_blank">${item.title}</a>
                        </div>
                        <div class="item-preview">
                            ${truncate(stripHtml(item.description || item.content || ''), 150)}
                        </div>
                        <div class="item-date">${formatDate(item.pubDate)}</div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error fetching blog:', error);
                document.getElementById('blog-content').innerHTML = 
                    `<div class="error">Error loading blog posts: ${error.message}</div>`;
            }
        }

        // Fetch GitHub Changelog
        async function fetchChangelog() {
            try {
                const response = await fetch(`${RSS2JSON_API}?rss_url=${encodeURIComponent(GITHUB_CHANGELOG_RSS)}`);
                const data = await response.json();
                
                if (data.status !== 'ok') {
                    throw new Error('Failed to fetch changelog RSS');
                }

                const container = document.getElementById('changelog-content');
                if (!data.items || data.items.length === 0) {
                    container.innerHTML = '<div class="error">No changelog entries available</div>';
                    return;
                }

                // TV Display: Limit to 8 items to fit on screen without scrolling
                const displayCount = Math.min(8, data.items.length);
                container.innerHTML = data.items.slice(0, displayCount).map(item => {
                    const badge = detectBadgeType(item.title, item.description || item.content || '');
                    const categories = item.categories && item.categories.length > 0 
                        ? item.categories.join(', ') 
                        : '';
                    
                    return `
                        <div class="item changelog-item">
                            <div class="item-title">
                                <a href="${item.link}" target="_blank">${item.title}</a>
                            </div>
                            <div class="item-preview">
                                ${truncate(stripHtml(item.description || item.content || ''), 120)}
                            </div>
                            <div class="item-date">
                                ${formatDate(item.pubDate)}
                                <span class="changelog-badge ${badge.class}">[${badge.type}]</span>
                                ${categories ? `<span class="changelog-category">${categories}</span>` : ''}
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error('Error fetching changelog:', error);
                document.getElementById('changelog-content').innerHTML = 
                    `<div class="error">Error loading changelog: ${error.message}</div>`;
            }
        }

        // Fetch GitHub Status
        async function fetchStatus() {
            try {
                const response = await fetch(GITHUB_STATUS_API);
                const data = await response.json();

                const container = document.getElementById('status-content');
                
                if (!data.incidents || data.incidents.length === 0) {
                    container.innerHTML = `
                        <div class="item status-card status-card-operational">
                            <div class="item-title">
                                <span class="status-symbol">●</span>
                                All Systems Operational
                            </div>
                        </div>
                    `;
                    return;
                }

                // TV Display: Limit to 7 status items (cards are more compact now)
                const displayCount = Math.min(7, data.incidents.length);
                container.innerHTML = data.incidents.slice(0, displayCount).map(incident => {
                    const impact = incident.impact;
                    const isResolved = incident.status === 'resolved';
                    
                    // If resolved, always show green. Otherwise use severity color.
                    const severityClass = isResolved 
                        ? 'status-card-operational'
                        : impact === 'critical' || impact === 'major' 
                            ? 'status-card-major' 
                            : impact === 'minor' 
                                ? 'status-card-minor' 
                                : 'status-card-operational';
                    
                    const symbol = impact === 'critical' || impact === 'major' 
                        ? '■' 
                        : impact === 'minor' 
                            ? '▲' 
                            : '●';
                    
                    const symbolClass = impact === 'critical' || impact === 'major'
                        ? 'status-symbol-major'
                        : impact === 'minor'
                            ? 'status-symbol-minor'
                            : 'status-symbol-operational';
                    
                    // For resolved incidents, skip boilerplate. For active, show brief update.
                    const statusText = incident.status.replace(/_/g, ' ');
                    
                    if (isResolved) {
                        return `
                            <div class="item status-card ${severityClass}">
                                <div class="item-title">
                                    <span class="status-symbol ${symbolClass}">${symbol}</span>
                                    ${incident.name}
                                </div>
                                <div class="item-date">
                                    ${formatDate(incident.created_at)}
                                    <span class="status-text">${statusText}</span>
                                </div>
                            </div>
                        `;
                    } else {
                        const updateText = incident.incident_updates && incident.incident_updates.length > 0 
                            ? truncate(stripHtml(incident.incident_updates[0].body), 100)
                            : `Status: ${incident.status.replace(/_/g, ' ').toUpperCase()}`;
                        
                        return `
                            <div class="item status-card ${severityClass}">
                                <div class="item-title">
                                    <span class="status-symbol ${symbolClass}">${symbol}</span>
                                    ${incident.name}
                                </div>
                                <div class="item-preview">
                                    ${updateText}
                                </div>
                                <div class="item-date">
                                    ${formatDate(incident.created_at)}
                                    <span class="status-text">${statusText}</span>
                                </div>
                            </div>
                        `;
                    }
                }).join('');
            } catch (error) {
                console.error('Error fetching status:', error);
                document.getElementById('status-content').innerHTML = 
                    `<div class="error">Error loading status: ${error.message}</div>`;
            }
        }

        // Pause/Resume state
        let isPaused = false;
        let refreshIntervalId = null;

        // Update timestamp
        function updateTimestamp() {
            const now = new Date();
            document.getElementById('timestamp').textContent = 
                now.toLocaleTimeString('en-US', { 
                    hour: '2-digit', 
                    minute: '2-digit'
                });
        }

        // Toggle pause/resume
        function togglePause() {
            isPaused = !isPaused;
            const pauseButton = document.getElementById('pauseButton');
            const pauseIcon = document.getElementById('pauseIcon');
            const pauseText = document.getElementById('pauseText');
            const liveText = document.getElementById('liveText');
            const liveDot = document.getElementById('liveDot');
            
            if (isPaused) {
                // Pause mode
                pauseIcon.textContent = '▶';
                pauseText.textContent = 'Resume';
                liveText.textContent = 'Paused';
                liveDot.classList.add('paused');
                
                // Clear refresh interval
                if (refreshIntervalId) {
                    clearInterval(refreshIntervalId);
                }
                if (progressInterval) {
                    clearInterval(progressInterval);
                }
                document.getElementById('refreshProgress').style.width = '0%';
            } else {
                // Resume mode
                pauseIcon.textContent = '⏸';
                pauseText.textContent = 'Pause';
                liveText.textContent = 'Live';
                liveDot.classList.remove('paused');
                
                // Restart refresh interval
                fetchAllData();
                refreshIntervalId = setInterval(fetchAllData, REFRESH_INTERVAL);
            }
        }

        // Refresh Progress Bar Animation
        let progressInterval;
        let progressStartTime;

        function startProgressBar() {
            const progressBar = document.getElementById('refreshProgress');
            progressStartTime = Date.now();
            
            // Reset progress bar
            progressBar.style.width = '0%';
            progressBar.classList.remove('refreshing');
            
            // Clear any existing interval
            if (progressInterval) {
                clearInterval(progressInterval);
            }
            
            // Update progress every second
            progressInterval = setInterval(() => {
                const elapsed = Date.now() - progressStartTime;
                const progress = Math.min((elapsed / REFRESH_INTERVAL) * 100, 100);
                
                progressBar.style.width = progress + '%';
                
                // Add glow effect in last 10 seconds
                if (progress > 96.67) {
                    progressBar.classList.add('refreshing');
                }
                
                // Reset when complete
                if (progress >= 100) {
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                        progressBar.classList.remove('refreshing');
                    }, 500);
                }
            }, 1000);
        }

        // Fetch all data
        async function fetchAllData() {
            if (isPaused) return;
            updateTimestamp();
            startProgressBar();
            await Promise.all([
                fetchBlog(),
                fetchChangelog(),
                fetchStatus()
            ]);
        }

        // Initialize dashboard
        updateTimestamp();
        fetchAllData();
        
        // Auto-refresh every 5 minutes
        refreshIntervalId = setInterval(fetchAllData, REFRESH_INTERVAL);
        
        // Pause button handler
        document.getElementById('pauseButton').addEventListener('click', togglePause);
        
        // Update timestamp every second
        setInterval(updateTimestamp, 1000);
    </script>
</body>
</html>
